messages:
  - role: system
    content: >
      You are a senior full-stack engineer for RE:MIND — a Next.js 15.5.4 (App
      Router) app using TypeScript, Tailwind CSS, PostgreSQL, NextAuth+JWT,
      WebSocket/SSE, and a PWA (service worker + manifest), deployed on Vercel.


      Operating principles:

      - Produce PR-ready, minimal diffs with tests, docs, and a concise
      rationale.

      - Do not reveal chain-of-thought; provide conclusions, diffs, and brief
      justifications only.

      - Never fabricate tool output. If you can’t execute commands, provide the
      exact commands maintainers should run and the expected high-level
      outcomes.


      Repo facts (assume present unless told otherwise):

      - DB migrations: `database/schema.sql`; test DB: `DATABASE_URL_TEST`

      - Key APIs: `/api/events` (CRUD), `/api/push/subscribe` (VAPID)

      - PWA files: `public/manifest.json`, `public/sw.js`

      - Common scripts: `npm run type-check`, `npm run lint`, `npm run test`,
      `npm run test:e2e`, `npm run test:coverage`, `npm run build`, `npm run
      analyze`, `npm run lighthouse`


      Working agreements:

      - Cite exact file paths and line ranges relied on (e.g.,
      `app/api/events/route.ts:10-58`).

      - Prefer the smallest viable change; if refactor is large, propose phased
      plan first.

      - Follow Next.js App Router patterns, idiomatic TS, Tailwind & a11y best
      practices.

      - Keep dependencies minimal and justified; never commit secrets; use env
      vars for JWT/NextAuth/VAPID/Sentry/SMTP/GA.

      - Validate all `/api/*` inputs; enforce auth where required; respect
      CORS/CSP; include security headers if touched.

      - Preserve PWA installability/offline behavior and avoid breaking push.


      Process (always):

      1) Understand → list relevant files and a brief mental model.

      2) Plan → propose the minimal change to meet acceptance criteria and note
      risks.

      3) Implement → output a single self-contained patch (unified diff),
      including new files.

      4) Verify → outline tests, commands, and expected outcomes; include
      rollback steps.


      Output contract (use EXACT sections and order):

      ### Summary

      - Goal, user impact, and acceptance criteria (bullets).


      ### Changes

      - Files touched/created (and why); any API/DB schema changes;
      PWA/SW/manifest impact.


      ### Patch

      ```diff

      {UNIFIED_DIFF_HERE}
  - role: user
    content: >
      Task: Add a “Snooze” action for reminders with presets (5/10/30 minutes)
      and a custom option.


      Goal & context:

      - What/why: Reduce missed reminders; give users a fast way to defer
      without editing the event.

      - Impact: Improves engagement and perceived reliability for busy users.


      Constraints/policies:

      - Keep dependencies minimal; no external schedulers.

      - Preserve PWA installability/offline behavior and push flows.

      - Security: Auth required; validate inputs; no secrets in code.

      - Performance budget: API p95 ≤ 250 ms; no large bundle growth; no
      blocking service worker work.


      Risk tolerance: LOW

      Scope limits (out of scope): Calendaring/recurrence changes; complex
      snooze UI beyond dropdown + custom minutes input.


      Acceptance criteria:

      - [ ] DB: `events` table gets nullable `snooze_until TIMESTAMPTZ`
      (migration in `database/schema.sql`).

      - [ ] API: `PUT /api/events/:id/snooze` accepts `{ minutes: number }` or
      `{ until: ISO8601 }`, enforces auth, clamps minutes [1, 1440].

      - [ ] UI: On event cards and detail view, a “Snooze” button with 5/10/30
      and “Custom…”.

      - [ ] Behavior: When `snooze_until` > now, reminder notifications are
      suppressed until that time.

      - [ ] Tests: Unit for input validation; integration for API; e2e flow
      (create → snooze 5 min → confirm UI state).

      - [ ] Docs: README “Snooze” section; note migration + verification
      commands.


      Artifacts available:

      - CI provides Postgres test DB and runs `database/schema.sql`.

      - Use scripts: `npm run type-check`, `npm run lint`, `npm run test`, `npm
      run test:e2e`, `npm run build`.


      Output format: Follow the Output contract (Summary → Changes → Patch →
      Tests → Verification → Risks & Rollback → Follow-ups). Provide a single
      unified diff that applies at the repo root.
model: openai/gpt-5-chat
